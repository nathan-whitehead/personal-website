@use "variables" as vars;
@use "mixins" as mix;

.article-content {
  h1 {
    @include mix.font-size(1.5rem);
    border-bottom: 1px solid var(--bs-primary);
  }
  h2 {
    @include mix.font-size(1.25rem);
    border-bottom: 1px solid var(--bs-border-color);
  }
  h3 {
    @include mix.font-size(1rem);
  }

  img {
    max-width: 100%;
    height: auto;
  }
  .image-carousel {
    margin: 2rem 0;
    overflow: hidden;
    width: 100%;

    .splide {
      // ensure container doesn't grow unnecessarily
      margin: 0 auto;
      padding-bottom: 1rem;

      .splide__track {
        // ensure track doesn't force full width
        overflow: visible;
      }

      .splide__list {
        // allow list to size to content
        display: flex;
        align-items: center;
      }

      .splide__pagination {
        bottom: 0;
      }

      .splide__slide {
        display: flex;
        justify-content: center;
        align-items: center;
        width: auto; // Allow the slide to size to its content
        max-width: 100%; // Prevent overflow

        figure {
          margin: 0;
          text-align: center;
          width: fit-content;
          max-width: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;

          img {
            display: block;
            max-width: 100%;
            height: auto;
            max-height: 70vh;
            margin: 0 auto; // Center the image
          }

          figcaption {
            text-align: center;
            padding: 0.5rem;
            font-style: italic;
            color: var(--bs-secondary-text);
            max-width: 100%; // Constrain to image width
            word-wrap: break-word; // Force word wrapping
            width: 100%; // Make caption take full width of figure
            overflow-wrap: break-word; // Additional wrapping support
            hyphens: auto; // Enable hyphenation for very long words
          }
        }
      }
      // Style the navigation arrows for better visibility
      .splide__arrow {
        background: rgba(255, 255, 255, 0.8);
        opacity: 0.7;

        &:hover {
          opacity: 1;
        }

        svg {
          fill: var(--bs-primary);
        }
      }

      // Style the pagination dots
      .splide__pagination__page {
        background: var(--bs-secondary);

        &.is-active {
          background: var(--bs-primary);
        }
      }
    }
  }

  ul.contains-task-list {
    list-style-type: none;
    padding-left: 1.5rem;

    li.task-list-item {
      margin-bottom: 0.5rem;
      position: relative;

      input[type="checkbox"] {
        margin-right: 0.5rem;

        // Custom checkbox styling (optional)
        &:checked + label {
          text-decoration: line-through;
          color: var(--bs-secondary-color);
        }
      }

      // Remove bullet points
      &::before {
        display: none;
      }
    }
  }

  code:not([class*="language-"]) {
    font-family: vars.$font-family-monospace;
    font-size: 0.85em;
    font-feature-settings: "calt" 1, "liga" 1;
    font-variant-ligatures: contextual;
    padding: 0em 0.2em;
    color: var(--bs-code-color, var(--bs-primary));
    background-color: var(--bs-code-bg);
    border-radius: var(--bs-border-radius-sm);
  }

  blockquote {
    // font-family: vars.$font-family-sans-serif;
    margin: 1.5rem 0;
    padding: 0.75rem 1.25rem;
    border-left: 4px solid var(--bs-primary);
    // background-color: var(--bs-tertiary-bg);

    background-color: rgba(0, 0, 0, 0.1);
    @include mix.dark-mode {
      background-color: rgba(255, 255, 255, 0.1);
    }
    border-radius: var(--bs-border-radius);
    // font-style: italic;

    > p:first-child {
      margin-top: 0;
    }

    > p:last-child {
      margin-bottom: 0;
    }

    // Handle nested blockquotes
    blockquote {
      margin: 1rem 0;
      border-left-color: var(--bs-secondary);
    }
    // Optional: style for attribution/citation
    cite {
      display: block;
      text-align: right;
      margin-top: 0.5rem;
      font-style: normal;
      font-weight: 500;

      &:before {
        content: "â€” ";
      }
    }
  }

  table {
    max-width: 100%;
    width: auto;
    margin: 1rem auto; // Center the table with auto left/right margins
    display: table;
    border-collapse: collapse;
    overflow-x: auto; // Handle wide tables on small screens

    // Add some spacing in cells for better readability
    th,
    td {
      padding: 0.25rem 0.25rem;
    }

    thead {
      border-bottom: 1px solid;

      th {
        font-weight: 600;
      }
    }

    // Add some hover effect
    tbody tr:hover {
      background-color: rgba(var(--bs-primary-rgb), 0.05);
    }
  }

  a {
    color: var(--bs-link-color);
    text-decoration: none;
    transition: color 0.2s ease-in-out;

    &:hover {
      // color: var(--bs-link-hover-color);
      text-decoration: underline;
    }
  }

  .footnote-ref {
    position: relative;

    a {
      text-decoration: none;
      padding: 0 2px;
      border-radius: 2px;
    }

    &.has-tooltip .footnote-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      max-width: 300px;
      width: max-content;
      background-color: var(--bs-body-bg);
      color: var(--bs-body-color);
      padding: 0.5rem 0.75rem;
      border-radius: var(--bs-border-radius);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      font-size: 0.875rem;
      z-index: 100;
      margin-bottom: 8px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
      pointer-events: none;
      border: 1px solid var(--bs-border-color);

      // Pointer triangle
      &:after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border-width: 6px;
        border-style: solid;
        border-color: var(--bs-body-bg) transparent transparent transparent;
      }

      // Dark mode styling
      @include mix.dark-mode {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      }
    }

    &:hover .footnote-tooltip {
      opacity: 1;
      visibility: visible;
    }
  }

  // Footnotes section at bottom
  .footnotes {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--bs-border-color);
    font-size: 0.9rem;

    ol {
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: 0.5rem;

      p {
        margin: 0;
        display: inline;
      }

      .footnote-backref {
        margin-left: 0.5rem;
        font-size: 0.85em;
      }
    }
  }

  dl {
    margin: 1rem 0;

    dt {
      font-weight: bold;
      // margin-bottom: 0.5rem;
    }

    dd {
      margin-left: 1.5rem;
      margin-bottom: 0.5rem;
    }
  }

  abbr {
    text-decoration: none;
    border-bottom: 1px dotted var(--bs-secondary);

    &:hover {
      // text-decoration: underline;
      position: relative;

      &::after {
        content: attr(title);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.25rem 0.5rem;
        background-color: var(--bs-body-bg);
        color: var(--bs-body-color);
        font-size: 0.8rem;
        border-radius: var(--bs-border-radius-sm);
        white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s, visibility 0.2s;
        z-index: 10;
        border: 1px solid var(--bs-border-color);

        @include mix.dark-mode {
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
      }

      &:hover::after {
        opacity: 1;
        visibility: visible;
      }
    }
  }

  details {
    .spoiler {
      border: 1px solid #aaa;
      border-radius: 4px;
      padding: 0.5em 0.5em 0;
      margin-bottom: 1em;
    }

    .spoiler summary {
      font-weight: bold;
      margin: -0.5em -0.5em 0;
      padding: 0.5em;
      cursor: pointer;
      background: #f0f0f0;
    }
  }
  span.spoiler {
    // border: 1px solid #aaa;
    border-radius: 4px;
    // padding: 0.5ezzm 0.5em 0;
    // margin-bottom: 1em;
    background-color: var(--bs-body-color);

    color: transparent;
    user-select: none;
    cursor: pointer;
    transition: background-color 0.3s ease;

    &:hover {
      background-color: rgba(var(--bs-body-color-rgb), 0.8);
    }

    &.revealed,
    &:active {
      background-color: transparent;
      color: var(--bs-body-color);
      user-select: auto;
    }
  }
}
