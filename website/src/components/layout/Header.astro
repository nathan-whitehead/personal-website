---
// frontmatter
const navLinkClasses = "nav-link hover:text-primary";
import { Image } from "astro:assets";
import { getLink } from "@utils/links.js";
import hedgehogImage from "@images/icons/hedgehog/hedgehog.png";
import { PreferencesManager } from "@utils/preferences.js";
---

<header
  id="site-header"
  class={`
    py-1 bg-paper-200 dark:bg-zinc-800 
    fixed w-full top-0 z-10
    transition-transform duration-300
    max-h-16
  `}
>
  <div class="mx-auto px-2 bg-paper-200 w-full dark:bg-zinc-800">
    <nav class="flex justify-between items-center">
      <a
        href="/"
        class="site-title font-title overflow-x-hidden whitespace-nowrap flex items-center"
      >
        <Image
          src={hedgehogImage}
          alt="Site icon: A cartoon hedgehog"
          class="h-12 w-auto mr-2"
          loading="eager"
        />
        <span
          class="text-3xl font-serif font-light text-stone-800 dark:text-zinc-200"
          >Nathan's Site</span
        >
      </a>

      <div class="flex items-center space-x-6 font-sans" id="navbarMain">
        <ul class="hidden md:flex items-center space-x-6">
          <li class="nav-item">
            <a class={navLinkClasses} href="/">HOME</a>
          </li>
          <li class="nav-item">
            <a class={navLinkClasses} href="/blog/">BLOG</a>
          </li>
          <li class="nav-item">
            <a class={navLinkClasses} href="/about/">ABOUT</a>
          </li>
          <li class="nav-item">
            <a class={navLinkClasses} href="/projects/">PROJECTS</a>
          </li>
        </ul>
        <button
          id="themeToggle"
          class="p-2 rounded m-0 hover:bg-paper-300 dark:hover:bg-zinc-700 flex items-center justify-center"
          aria-label="Toggle dark mode"
        >
          <span id="theme-toggle-icon" class="material-symbols-outlined">
            light_mode
          </span>
        </button>

        <button
          class="md:hidden p-2 rounded hover:bg-paper-300 dark:hover:bg-zinc-700 flex items-center justify-center"
          id="mobileMenuToggle"
          aria-label="Toggle navigation"
        >
          <i class="bi bi-list text-xl"></i>
        </button>
      </div>
    </nav>

    <div
      id="mobileMenu"
      class="hidden mt-4 pt-4 border-t bg-paper-200 border-paper-300 dark:bg-zinc-800 dark:border-zinc-700 md:hidden font-sans"
    >
      <div class="columns-2">
        <ul class="space-y-3">
          <li>
            <a
              href="/"
              class="block hover:text-paper-700 text-center dark:hover:text-paper-200"
              >HOME</a
            >
          </li>
          <li>
            <a
              href="/blog/"
              class="block hover:text-paper-700 text-center dark:hover:text-paper-200"
              >BLOG</a
            >
          </li>
          <li>
            <a
              href="/about/"
              class="block hover:text-paper-700 text-center dark:hover:text-paper-200"
              >ABOUT</a
            >
          </li>
          <li>
            <a
              href="/projects/"
              class="block hover:text-paper-700 text-center dark:hover:text-paper-200"
              >PROJECTS</a
            >
          </li>
        </ul>
      </div>
    </div>
  </div>
</header>

<div id="header-offset" class="h-16"></div>

<script>
  import { ThemeManager } from "@utils/theme-manager.js";

  function initializeHeader() {
    ThemeManager.initialize();
    ThemeManager.setupEventListeners();

    // Setup mobile menu (this could also be moved to its own module)
    const mobileMenuToggle = document.getElementById("mobileMenuToggle");
    const mobileMenu = document.getElementById("mobileMenu");

    if (mobileMenuToggle && mobileMenu) {
      // Clone to remove old listeners
      const newMenuToggle = mobileMenuToggle.cloneNode(true);
      if (mobileMenuToggle.parentNode) {
        mobileMenuToggle.parentNode.replaceChild(
          newMenuToggle,
          mobileMenuToggle
        );
      }

      newMenuToggle.addEventListener("click", () => {
        const menuElement = document.getElementById("mobileMenu");
        if (menuElement) {
          menuElement.classList.toggle("hidden");
        }
      });
    }
  }

  // Initialize theme system
  document.addEventListener("DOMContentLoaded", initializeHeader);
  document.addEventListener("astro:page-load", initializeHeader);
</script>
